<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">Tout</span>,<span class="var type1" id="S3T1U4">Isoln</span>,<span class="var type1" id="S4T2U5">Ysoln</span>] = naivePerfusionResponsecalP2X7(<span class="var type1" id="S5T1U8">ton</span>,<span class="var type1" id="S6T1U9">toff</span>,<span class="var type1" id="S7T6U10">Ttot</span>,<span class="var type1" id="S8T1U11">T</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">global</span> <span class="var type1" id="S9T6U13">ATP</span> <span class="var type1" id="S10T6U14">A</span> <span class="var type1" id="S11T19U15">p0</span> <span class="var type1" id="S12T1U16">Tsoln</span> <span class="var type1" id="S13T1U17">I</span> <span class="var type1" id="S14T2U18">Y</span> <span class="var type1" id="S15T6U19">imin</span> <span class="var type1" id="S16T6U20">imax</span> <span class="var type1" id="S17T6U21">t0</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line">    <span class="comment">%#codgen;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T8:U17"><span class="mxinfo" id="T6:U18">max(<span class="var type1" id="S8T1U27">T</span>)</span>&lt;<span class="var type1" id="S7T6U28">Ttot</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line">        <span class="mxinfo" id="T6:U21"><span class="var type1" id="S19T6U31">dt</span>=<span class="mxinfo" id="T6:U23"><span class="mxinfo" id="T6:U24"><span class="var type1" id="S8T1U34">T</span>(<span class="mxinfo" id="T6:U26">2</span>)</span>-<span class="mxinfo" id="T6:U27"><span class="var type1" id="S8T1U37">T</span>(<span class="mxinfo" id="T6:U29">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">        <span class="mxinfo" id="T1:U30"><span class="var type1" id="S12T1U41">Tsoln</span>=<span class="mxinfo" id="T1:U32">[<span class="mxinfo" id="T1:U33"><span class="var type1" id="S8T1U45">T</span>(<span class="mxinfo" id="T6:U35">1</span>:<span class="mxinfo" id="T6:U36"><span class="mxinfo" id="T6:U37">end</span>-<span class="mxinfo" id="T6:U38">1</span></span>)</span>;<span class="mxinfo" id="T1:U39">(<span class="mxinfo" id="T16:U40"><span class="mxinfo" id="T6:U41"><span class="var type1" id="S8T1U58">T</span>(<span class="mxinfo" id="T6:U43">end</span>)</span>:<span class="var type1" id="S19T6U61">dt</span>:<span class="var type1" id="S7T6U62">Ttot</span></span>).'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">        <span class="mxinfo" id="T1:U46"><span class="var type1" id="S12T1U66">Tsoln</span>=<span class="mxinfo" id="T1:U48"><span class="var type1" id="S8T1U68">T</span>(<span class="mxinfo" id="T17:U50"><span class="var type1" id="S8T1U70">T</span>&lt;=<span class="var type1" id="S7T6U71">Ttot</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo" id="T6:U53"><span class="var type1" id="S21T6U74">Nt</span>=<span class="mxinfo" id="T6:U55">length(<span class="var type1" id="S12T1U77">Tsoln</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo" id="T1:U57"><span class="var type1" id="S2T1U80">Tout</span>=<span class="mxinfo" id="T1:U59">zeros(<span class="var type1" id="S21T6U83">Nt</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo" id="T1:U61"><span class="var type1" id="S13T1U87">I</span>=<span class="mxinfo" id="T1:U63">zeros(<span class="var type1" id="S21T6U90">Nt</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo" id="T1:U65"><span class="var type1" id="S3T1U94">Isoln</span>=<span class="mxinfo" id="T1:U67">zeros(<span class="var type1" id="S21T6U97">Nt</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo" id="T2:U69"><span class="var type1" id="S14T2U101">Y</span>=<span class="mxinfo" id="T2:U71">zeros(<span class="var type1" id="S21T6U104">Nt</span>,<span class="mxinfo" id="T6:U73">24</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo" id="T2:U74"><span class="var type1" id="S4T2U108">Ysoln</span>=<span class="mxinfo" id="T2:U76">zeros(<span class="var type1" id="S21T6U111">Nt</span>,<span class="mxinfo" id="T6:U78">24</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo" id="T19:U79"><span class="var type1" id="S11T19U115">p0</span>=<span class="mxinfo" id="T19:U81">zeros(<span class="mxinfo" id="T6:U82">1</span>,<span class="mxinfo" id="T6:U83">24</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo" id="T6:U84"><span class="mxinfo" id="T6:U85"><span class="var type1" id="S11T19U123">p0</span>(<span class="mxinfo" id="T6:U87">1</span>)</span>=<span class="mxinfo" id="T6:U88">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo" id="T17:U89"><span class="var type1" id="S24T17U128">indBef</span>=<span class="mxinfo" id="T17:U91"><span class="var type1" id="S8T1U130">T</span>&lt;<span class="mxinfo" id="T6:U93"><span class="var type1" id="S5T1U132">ton</span>(<span class="mxinfo" id="T6:U95">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo" id="T2:U96"><span class="mxinfo" id="T2:U97"><span class="var type1" id="S14T2U137">Y</span>(<span class="var type1" id="S24T17U138">indBef</span>,:)</span>=<span class="mxinfo" id="T2:U100">repmat(<span class="var type1" id="S11T19U142">p0</span>,<span class="mxinfo" id="T6:U102">sum(<span class="var type1" id="S24T17U145">indBef</span>)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo" id="T9:U104"><span class="var type1" id="S5T9U149">ton</span>=<span class="mxinfo" id="T9:U106">[<span class="var type1" id="S5T1U152">ton</span>,<span class="var type1" id="S7T6U153">Ttot</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S27T6U156">i</span>=<span class="mxinfo" id="T6:U110">1:length(<span class="var type1" id="S5T9U162">ton</span>)-1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">        <span class="mxinfo" id="T6:U112"><span class="var type1" id="S10T6U166">A</span>=<span class="var type1" id="S9T6U167">ATP</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">        <span class="mxinfo" id="T1:U115"><span class="var type1" id="S28T1U170">ind</span>=<span class="mxinfo" id="T1:U117">find(<span class="mxinfo" id="T17:U118"><span class="mxinfo" id="T17:U119"><span class="var type1" id="S8T1U175">T</span>&gt;<span class="mxinfo" id="T6:U121"><span class="var type1" id="S5T9U177">ton</span>(<span class="mxinfo" id="T6:U123"><span class="var type1" id="S27T6U178">i</span></span>)</span></span>&amp;<span class="mxinfo" id="T17:U125"><span class="var type1" id="S8T1U180">T</span>&lt;=<span class="mxinfo" id="T6:U127"><span class="var type1" id="S6T1U182">toff</span>(<span class="mxinfo" id="T6:U129"><span class="var type1" id="S27T6U183">i</span></span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">        <span class="mxinfo" id="T6:U131"><span class="var type1" id="S15T6U186">imin</span>=<span class="mxinfo" id="T6:U133"><span class="var type1" id="S28T1U188">ind</span>(<span class="mxinfo" id="T6:U135">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">        <span class="mxinfo" id="T6:U136"><span class="var type1" id="S16T6U192">imax</span>=<span class="mxinfo" id="T6:U138"><span class="var type1" id="S28T1U194">ind</span>(<span class="mxinfo" id="T6:U140">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        <span class="mxinfo" id="T6:U141"><span class="var type1" id="S17T6U199">t0</span>=<span class="mxinfo" id="T6:U143"><span class="var type1" id="S5T9U201">ton</span>(<span class="mxinfo" id="T6:U145"><span class="var type1" id="S27T6U202">i</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="fcn" id="F265N4:B205">linearODESolvecalP2X7</span>();</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">        <span class="mxinfo" id="T6:U147"><span class="var type1" id="S10T6U208">A</span>=<span class="mxinfo" id="T6:U149">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">        <span class="mxinfo" id="T1:U150"><span class="var type1" id="S28T1U212">ind</span>=<span class="mxinfo" id="T1:U152">find(<span class="mxinfo" id="T17:U153"><span class="mxinfo" id="T17:U154"><span class="var type1" id="S8T1U217">T</span>&gt;<span class="var type1" id="S6T1U218">toff</span></span>&amp;<span class="mxinfo" id="T17:U157"><span class="var type1" id="S8T1U220">T</span>&lt;=<span class="mxinfo" id="T6:U159"><span class="var type1" id="S5T9U222">ton</span>(<span class="mxinfo" id="T6:U161"><span class="var type1" id="S27T6U224">i</span>+1</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T8:U163"><span class="mxinfo" id="T6:U164">length(<span class="var type1" id="S28T1U231">ind</span>)</span>~=<span class="mxinfo" id="T6:U166">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">            <span class="mxinfo" id="T6:U167"><span class="var type1" id="S15T6U235">imin</span>=<span class="mxinfo" id="T6:U169"><span class="var type1" id="S28T1U237">ind</span>(<span class="mxinfo" id="T6:U171">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">            <span class="mxinfo" id="T6:U172"><span class="var type1" id="S16T6U241">imax</span>=<span class="mxinfo" id="T6:U174"><span class="var type1" id="S28T1U243">ind</span>(<span class="mxinfo" id="T6:U176">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">            <span class="mxinfo" id="T6:U177"><span class="var type1" id="S17T6U248">t0</span>=<span class="mxinfo" id="T6:U179"><span class="var type1" id="S6T1U250">toff</span>(<span class="mxinfo" id="T6:U181"><span class="var type1" id="S27T6U251">i</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">            <span class="fcn" id="F265N4:B254">linearODESolvecalP2X7</span>();</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo" id="T1:U183"><span class="var type1" id="S2T1U257">Tout</span>=<span class="var type1" id="S12T1U258">Tsoln</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo" id="T1:U186"><span class="var type1" id="S3T1U261">Isoln</span>=<span class="var type1" id="S13T1U262">I</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T2:U189"><span class="var type1" id="S4T2U265">Ysoln</span>=<span class="var type1" id="S14T2U266">Y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
